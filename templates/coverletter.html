<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InJob - 자기소개서 AI 코칭</title>
    <link rel="stylesheet" href="/static/coverletter.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-container">
                    <img src="/static/inje_logo.jpg" alt="인제대학교 로고" class="inje-logo">
                    <div class="logo">InJob</div>
                </div>
                <div class="subtitle">자기소개서 AI 코칭</div>
            </div>
        </div>
    </header>

    <main>
        <div class="resume-container">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">자기소개서 작성</h2>
                    <p class="card-subtitle">AI가 분석할 자기소개서를 입력해주세요</p>
                </div>
                <div class="card-body">
                    <form id="coaching-form" method="post" onsubmit="submitCoverLetter(event)">
                        <div class="form-section">
                            <h3 class="section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M17 18a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v12z" />
                                    <path d="M12 14H9" />
                                    <path d="M16 8h-3" />
                                    <path d="M16 11h-4" />
                                </svg>
                                지원 분야
                            </h3>
                            <div class="field-container">
                                <select id="application-field" name="application_field" class="select-field">
                                    <option value="" disabled selected>지원하려는 직무를 선택하세요</option>
                                    <option value="개발">개발</option>
                                    <option value="기획">기획</option>
                                    <option value="디자인">디자인</option>
                                    <option value="마케팅">마케팅</option>
                                    <option value="영업">영업</option>
                                    <option value="연구">연구</option>
                                    <option value="인사">인사</option>
                                    <option value="재무">재무</option>
                                    <option value="기타">기타</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                    <path
                                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z" />
                                </svg>
                                코칭 옵션
                            </h3>
                            <div class="coaching-options">
                                <label class="option-label">
                                    <input type="checkbox" name="analysis_option" value="strength" checked>
                                    <span>강점 분석</span>
                                </label>
                                <label class="option-label">
                                    <input type="checkbox" name="analysis_option" value="weakness" checked>
                                    <span>약점 분석</span>
                                </label>
                                <label class="option-label">
                                    <input type="checkbox" name="analysis_option" value="improvement" checked>
                                    <span>개선된 버전 제공</span>
                                </label>
                                <label class="option-label">
                                    <input type="checkbox" name="analysis_option" value="feedback">
                                    <span>구체적인 피드백 포인트</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M17 18a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v12z" />
                                    <path d="M12 14H9" />
                                    <path d="M16 8h-3" />
                                    <path d="M16 11h-4" />
                                </svg>
                                자기소개서
                            </h3>
                            <textarea id="cover-letter" name="cover_letter"
                                placeholder="자기소개서를 입력하세요. 성격, 강점, 역량, 경험, 지원 동기 등을 포함하면 좋습니다. (최소 300자 이상)">{{ cover_letter if cover_letter else '' }}</textarea>
                            <div class="character-count">
                                <span id="char-count">0</span> / 1000자
                            </div>
                        </div>

                        <div class="action-row">
                            <button type="reset" class="btn btn-add">초기화</button>
                            <button type="submit" class="btn btn-primary action-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M21 12a9 9 0 0 1-9 9"></path>
                                    <path d="M9 21a9 9 0 0 1-9-9"></path>
                                    <path d="M3 12a9 9 0 0 1 9-9"></path>
                                    <path d="M21 12a9 9 0 0 0-9-9"></path>
                                    <path d="M12 3v8l4 4"></path>
                                </svg>
                                코칭 시작하기
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card coaching-result">
                <div class="card-header">
                    <h2 class="card-title">AI 코칭 결과</h2>
                    <p class="card-subtitle">자기소개서를 분석하고 개선 방향을 제시해 드립니다</p>
                </div>
                <div class="card-body">
                    <div id="result-content" class="result-content {% if not coaching_result %}empty{% endif %}">
                        {% if coaching_result %}
                        {{ coaching_result|safe }}
                        {% else %}
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                            <h3>AI 코칭 준비 완료</h3>
                            <p>왼쪽에 자기소개서를 입력하고 코칭 시작하기 버튼을 눌러주세요.</p>
                        </div>
                        {% endif %}
                    </div>

                    <div id="loading" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>AI가 자기소개서를 분석하고 있습니다...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <a href="/" class="back-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            홈으로 돌아가기
        </a>
    </footer>

    <script>
        const coverLetterTextarea = document.getElementById('cover-letter');
        const charCount = document.getElementById('char-count');

        coverLetterTextarea.addEventListener('input', function () {
            const count = this.value.length;
            charCount.textContent = count;

            // 글자 수에 따라 색상 변경
            if (count < 300) {
                charCount.style.color = '#dc3545';
            } else if (count > 800) {
                charCount.style.color = '#28a745';
            } else {
                charCount.style.color = '#333';
            }
        });

        async function submitCoverLetter(event) {
            event.preventDefault();

            // 폼 필드 값 가져오기
            const coverLetter = document.getElementById('cover-letter').value;
            const applicationField = document.getElementById('application-field').value;

            // 검증
            if (coverLetter.length < 300) {
                alert('자기소개서는 최소 300자 이상 작성해주세요.');
                return;
            }

            if (!applicationField) {
                alert('지원 분야를 선택해주세요.');
                return;
            }

            // 체크박스가 하나도 선택되지 않았는지 확인
            const analysisOptions = document.querySelectorAll('input[name="analysis_option"]:checked');
            if (analysisOptions.length === 0) {
                alert('최소 하나 이상의 코칭 옵션을 선택해주세요.');
                return;
            }

            const loadingElement = document.getElementById('loading');
            const resultContent = document.getElementById('result-content');

            // Show loading, hide result
            loadingElement.style.display = 'flex';
            resultContent.style.display = 'none';

            // 폼 데이터 수집
            const form = document.getElementById('coaching-form');
            const formData = new FormData(form);

            try {
                const response = await fetch('/coverletter', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    loadingElement.style.display = 'none';
                    resultContent.style.display = 'block';
                    resultContent.classList.remove('empty');
                    resultContent.innerHTML = result.coaching_result;
                } else {
                    // 에러 응답 처리 추가
                    const errorData = await response.json();
                    throw new Error(errorData.message || '서버 응답 오류');
                }
            } catch (error) {
                loadingElement.style.display = 'none';
                resultContent.style.display = 'block';
                resultContent.classList.remove('empty');
                resultContent.innerHTML = `<p>코칭 생성 중 오류가 발생했어요: ${error.message}. 다시 시도해 주세요!</p>`;
                console.error(error);
            }
        }
    </script>
</body>

</html>